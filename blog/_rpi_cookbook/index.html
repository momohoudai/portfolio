<html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://www.w3schools.com/w3css/4/w3.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inconsolata"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Source+Code+Pro"><link rel=stylesheet href=/css/common.css><link rel=stylesheet href=/css/syntax.css><link rel="shortcut icon" type=image/png href=/img/favicon.png><title>Gerald's Website</title>
<script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body><div class=container><div class=profile><h1>momo</h1><h2>just another place for me to talk about things i like</h2></div><div class=nav><a href=/>Home</a>
<a href=/blog>Blog</a>
<a href=/portfolio>Portfolio</a>
<a href=https://twitter.com/momohoudai>X</a></div><hr><div class=blog-body><div class=blog-title>My Raspberry PI Cookbook</div><div class=blog-date-tag-wrapper><div class=blog-date><time datetime=2023-03-12T12:00:00+08:00>Mar 12, 2023</time></div><div class=blog-tag>tech</div></div><div class=blog-body><p>I figured that I might as well save a Raspberry PI cookbook somewhere.</p><p>Note that these are for Raspberry PI OS.
Some of these will work on other Linux distributions (especially Debian since Raspbian derives from it).
te that these are for Raspberry PI OS.</p><p>But you know, Linux being linux and distributions being distributions, not all of them will work for everything.
Since I only use Raspberry PI right now, I&rsquo;ll just stick to the commands being for the Raspberry PI.</p><p>I will update this cookbook every now and then when I play with my PI.</p><h1 id=user>User</h1><p>Check what groups the current user is under</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>groups
</span></span></code></pre></div><h1 id=disk-space>Disk space</h1><p>Displaying disk space in human-readable format</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>df -h
</span></span></code></pre></div><h1 id=processes>Processes</h1><p>Displaying processes</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>ps
</span></span></code></pre></div><p>Monitor processes (press &lsquo;q&rsquo; to quit)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>htop
</span></span></code></pre></div><h1 id=file>File</h1><p>Monitoring a file</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># Monitors the last N lines of a file</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -n is optional</span>
</span></span><span style=display:flex><span>tail -n <span style=color:#f92672>[</span>N<span style=color:#f92672>]</span>  -f <span style=color:#f92672>[</span>FILENAME<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Printing a file</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cat <span style=color:#f92672>[</span>FILENAME<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Printing a in reverse (line-wise)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>tac <span style=color:#f92672>[</span>FILENAME<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Grepping a file</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>grep <span style=color:#f92672>[</span>OPTIONS <span style=color:#f92672>(</span>optional<span style=color:#f92672>)]</span> <span style=color:#f92672>[</span>PATTERN<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>FILES<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># for example, this greps all &#34;hello&#34; in the files main.c and main.h</span>
</span></span><span style=display:flex><span>grep hello main.c main.h
</span></span></code></pre></div><p>Grepping a file with regex</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>grep -E <span style=color:#f92672>[</span>PATTERN<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>FILES<span style=color:#f92672>]</span>
</span></span></code></pre></div><h1 id=network>Network</h1><p>Displays active network connections and their corresponding processes</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo netstat -nltp
</span></span></code></pre></div><h1 id=enable-vnc-and-ssh>Enable VNC and SSH</h1><p>Open the terminal on the RPI, then:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo raspi-config
</span></span></code></pre></div><p>Select [Interfacing Options] > VNC > Yes > Ok</p><h1 id=enable-ssh-with-publicprivate-key-authentication>Enable SSH with public/private key authentication</h1><p>Let&rsquo;s define device R as the RPI and device C as the computer you want to connect from.
We assume that C has already generated its public/private key pair.</p><p>Open the terminal on R, then:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo raspi-config
</span></span></code></pre></div><p>Select [Interfacing Options] > SSH > Yes > Ok</p><p>Then, make the following directory:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>install -d -m <span style=color:#ae81ff>700</span> ~/.ssh
</span></span></code></pre></div><p>Open your favourite text editor (e.g. nano, vim, nvim) on <code>~/.ssh/authorized_keys</code>. I like vim so:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo vim ~/.ssh/authorized_keys
</span></span></code></pre></div><p>Then somehow, someway, copy paste the public key from device C into that file and save.</p><p>Then, make sure that the permissions of that file is set correctly:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo chmod <span style=color:#ae81ff>644</span> ~/.ssh/authorized_keys
</span></span></code></pre></div><p>Finally, we have to disable password authentication.
Open the following file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo vim /etc/ssh/sshd_config
</span></span></code></pre></div><p>Add the following line:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>PasswordAuthentication no
</span></span></code></pre></div><p>For any errors related to this, the log is avaliable at this file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>/var/log/auth.log
</span></span></code></pre></div><p>NOTE: You can, of course, use <code>ssh-copy-id</code> command from device C to setup the RSA authentication on device R.
It basically does the steps related to placing device C&rsquo;s public key into device R&rsquo;s <code>authorized_keys</code> file.
That assumes that you DO have <code>ssh-copy-id</code> available in device C.</p><h1 id=docker>Docker</h1><h2 id=installation>Installation</h2><p>Run the crazy script that will setup Docker.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>curl -sSL https://get.docker.com | sh
</span></span></code></pre></div><p>Any user that requires Docker will need to be added to the &lsquo;docker&rsquo; group.
Let&rsquo;s say my username is &lsquo;momo&rsquo;, I will then do the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo usermod -aG docker momo
</span></span></code></pre></div><p>Log out and log in again for the changes to take effect.
After you log in, enter the command below display the list of groups you are under.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>groups
</span></span></code></pre></div><p>Check that &lsquo;docker&rsquo; is in the list displayed.</p><p>To test that Docker is running, do the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker run hello-world
</span></span></code></pre></div><p>You should see text displayed as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>Hello from Docker!
</span></span><span style=display:flex><span>This message shows that your installation appears to be working correctly.
</span></span></code></pre></div><h2 id=useful-commands>Useful commands</h2><p>Clean up any unused resources (including images)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker system prune -a
</span></span></code></pre></div><p>List all containers</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker ps -a
</span></span></code></pre></div><p>Remove containers</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker rm <span style=color:#f92672>[</span>CONTAINER ID OR NAME...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Example: removing all containers</span>
</span></span><span style=display:flex><span>docker rm <span style=color:#66d9ef>$(</span>docker ps -a -q<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><p>List all images</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker images -a
</span></span></code></pre></div><p>Remove images.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker rmi <span style=color:#f92672>[</span>Images...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Example: removing ALL images</span>
</span></span><span style=display:flex><span>docker rmi <span style=color:#66d9ef>$(</span>docker images -a -q<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><p>Stop container.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker stop <span style=color:#f92672>[</span>CONTAINER ID OR NAME<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Example: stops all containers</span>
</span></span><span style=display:flex><span>docker stop <span style=color:#66d9ef>$(</span>docker ps -a -q<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><p>Compose: setups up a bunch of container and&mldr;does a bunch of things.
Docker Compose needs a YML file to run.
By default, it runes docker-compose.yml in the current directory.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker compose up -d 
</span></span></code></pre></div><h1 id=systemdservice>systemd.service</h1><p>systemd.service is a way to manage your application into services in Debian/Ubuntu based Linux.
Simply write create a file with a .service extention containing content like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#f92672>[</span>Unit<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Description<span style=color:#f92672>=</span>My discord bot service
</span></span><span style=display:flex><span>After<span style=color:#f92672>=</span>network.target
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Service<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>ExecStart<span style=color:#f92672>=</span>/command/to/execute
</span></span><span style=display:flex><span>WorkingDirectory<span style=color:#f92672>=</span>/home/place/to/execute
</span></span><span style=display:flex><span>StandardOutput<span style=color:#f92672>=</span>inherit
</span></span><span style=display:flex><span>StandardError<span style=color:#f92672>=</span>inherit
</span></span><span style=display:flex><span>Restart<span style=color:#f92672>=</span>always
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Install<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>WantedBy<span style=color:#f92672>=</span>multi-user.target
</span></span></code></pre></div><p>Toss it into <code>/etc/systemd/your_app.service</code>, and you could be able to use it like a service.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>systemctl start your_app
</span></span></code></pre></div></div></div></div><footer>Powered By Hugo | v2.0 | © 2024 Momoko Mopiko</footer></body></html>