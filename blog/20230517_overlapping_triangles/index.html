<html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://www.w3schools.com/w3css/4/w3.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inconsolata"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Source+Code+Pro"><link rel=stylesheet href=/css/common.css><link rel=stylesheet href=/css/syntax.css><link rel="shortcut icon" type=image/png href=/img/favicon.png><title>Gerald's Website</title><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body><div class=container><div class=profile><h1>momo</h1><h2>just another place for me to talk about things i like</h2></div><div class=nav><a href=/>Home</a>
<a class=nav-target href=/blog>Blog</a>
<a href=/portfolio>Portfolio</a>
<a href=https://twitter.com/momohoudai>Twitter</a></div><div class=tag-nav><a class=tag-nav-target href=/blog>all</a>
<a href=/tags/tech>tech</a>
<a href=/tags/irl>irl</a>
<a href=/tags/design>design</a></div><hr><div class=blog-body><div class=blog-title>Point on triangle algorithms</div><div class=blog-date-tag-wrapper><div class=blog-date><time datetime=2023-05-18T11:16:00+08:00>May 18, 2023</time></div><div class=blog-tag>tech</div></div><div class=blog-body><p>A game I&rsquo;m working on requires me to check if a point is overlapped by a triangle.
Being a dumb engineer who can&rsquo;t come up wiith his own algorithm, google gave me 3 algorithms.
Here I&rsquo;m just going to share the algorithms and their performances.</p><p>Parametric:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>b32_t</span> <span class=nf>parametric</span><span class=p>(</span><span class=n>v2f_t</span> <span class=n>tp0</span><span class=p>,</span> <span class=n>v2f_t</span> <span class=n>tp1</span><span class=p>,</span> <span class=n>v2f_t</span> <span class=n>tp2</span><span class=p>,</span> <span class=n>v2f_t</span> <span class=n>pt</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>f32_t</span> <span class=n>denominator</span> <span class=o>=</span> <span class=p>(</span><span class=n>tp0</span><span class=p>.</span><span class=n>x</span><span class=o>*</span><span class=p>(</span><span class=n>tp1</span><span class=p>.</span><span class=n>y</span> <span class=o>-</span> <span class=n>tp2</span><span class=p>.</span><span class=n>y</span><span class=p>)</span> <span class=o>+</span> 
</span></span><span class=line><span class=cl>                     <span class=n>tp0</span><span class=p>.</span><span class=n>y</span><span class=o>*</span><span class=p>(</span><span class=n>tp2</span><span class=p>.</span><span class=n>x</span> <span class=o>-</span> <span class=n>tp1</span><span class=p>.</span><span class=n>x</span><span class=p>)</span> <span class=o>+</span> 
</span></span><span class=line><span class=cl>                     <span class=n>tp1</span><span class=p>.</span><span class=n>x</span><span class=o>*</span><span class=n>tp2</span><span class=p>.</span><span class=n>y</span> <span class=o>-</span> <span class=n>tp1</span><span class=p>.</span><span class=n>y</span><span class=o>*</span><span class=n>tp2</span><span class=p>.</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=n>f32_t</span> <span class=n>t1</span> <span class=o>=</span> <span class=p>(</span><span class=n>pt</span><span class=p>.</span><span class=n>x</span><span class=o>*</span><span class=p>(</span><span class=n>tp2</span><span class=p>.</span><span class=n>y</span> <span class=o>-</span> <span class=n>tp0</span><span class=p>.</span><span class=n>y</span><span class=p>)</span> <span class=o>+</span> 
</span></span><span class=line><span class=cl>            <span class=n>pt</span><span class=p>.</span><span class=n>y</span><span class=o>*</span><span class=p>(</span><span class=n>tp0</span><span class=p>.</span><span class=n>x</span> <span class=o>-</span> <span class=n>tp2</span><span class=p>.</span><span class=n>x</span><span class=p>)</span> <span class=o>-</span> 
</span></span><span class=line><span class=cl>            <span class=n>tp0</span><span class=p>.</span><span class=n>x</span><span class=o>*</span><span class=n>tp2</span><span class=p>.</span><span class=n>y</span> <span class=o>+</span> <span class=n>tp0</span><span class=p>.</span><span class=n>y</span><span class=o>*</span><span class=n>tp2</span><span class=p>.</span><span class=n>x</span><span class=p>)</span> <span class=o>/</span> <span class=n>denominator</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=n>f32_t</span> <span class=n>t2</span> <span class=o>=</span> <span class=p>(</span><span class=n>pt</span><span class=p>.</span><span class=n>x</span><span class=o>*</span><span class=p>(</span><span class=n>tp1</span><span class=p>.</span><span class=n>y</span> <span class=o>-</span> <span class=n>tp0</span><span class=p>.</span><span class=n>y</span><span class=p>)</span> <span class=o>+</span> 
</span></span><span class=line><span class=cl>            <span class=n>pt</span><span class=p>.</span><span class=n>y</span><span class=o>*</span><span class=p>(</span><span class=n>tp0</span><span class=p>.</span><span class=n>x</span> <span class=o>-</span> <span class=n>tp1</span><span class=p>.</span><span class=n>x</span><span class=p>)</span> <span class=o>-</span> 
</span></span><span class=line><span class=cl>            <span class=n>tp0</span><span class=p>.</span><span class=n>x</span><span class=o>*</span><span class=n>tp1</span><span class=p>.</span><span class=n>y</span> <span class=o>+</span> <span class=n>tp0</span><span class=p>.</span><span class=n>y</span><span class=o>*</span><span class=n>tp1</span><span class=p>.</span><span class=n>x</span><span class=p>)</span> <span class=o>/</span> <span class=o>-</span><span class=n>denominator</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=n>f32_t</span> <span class=n>s</span> <span class=o>=</span> <span class=n>t1</span> <span class=o>+</span> <span class=n>t2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span> <span class=o>&lt;=</span> <span class=n>t1</span> <span class=o>&amp;&amp;</span> <span class=n>t1</span> <span class=o>&lt;=</span> <span class=mi>1</span> <span class=o>&amp;&amp;</span> <span class=mi>0</span> <span class=o>&lt;=</span> <span class=n>t2</span> <span class=o>&amp;&amp;</span> <span class=n>t2</span> <span class=o>&lt;=</span> <span class=mi>1</span> <span class=o>&amp;&amp;</span> <span class=n>s</span> <span class=o>&lt;=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Dot Product:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>b32_t</span> <span class=nf>dot_product</span><span class=p>(</span><span class=n>v2f_t</span> <span class=n>tp0</span><span class=p>,</span> <span class=n>v2f_t</span> <span class=n>tp1</span><span class=p>,</span> <span class=n>v2f_t</span> <span class=n>tp2</span><span class=p>,</span> <span class=n>v2f_t</span> <span class=n>pt</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>v2f_t</span> <span class=n>vec0</span> <span class=o>=</span> <span class=n>v2f_set</span><span class=p>(</span><span class=n>pt</span><span class=p>.</span><span class=n>x</span> <span class=o>-</span> <span class=n>tp0</span><span class=p>.</span><span class=n>x</span><span class=p>,</span> <span class=n>pt</span><span class=p>.</span><span class=n>y</span> <span class=o>-</span> <span class=n>tp0</span><span class=p>.</span><span class=n>y</span><span class=p>);</span>      
</span></span><span class=line><span class=cl>  <span class=n>v2f_t</span> <span class=n>vec1</span> <span class=o>=</span> <span class=n>v2f_set</span><span class=p>(</span><span class=n>pt</span><span class=p>.</span><span class=n>x</span> <span class=o>-</span> <span class=n>tp1</span><span class=p>.</span><span class=n>x</span><span class=p>,</span> <span class=n>pt</span><span class=p>.</span><span class=n>y</span> <span class=o>-</span> <span class=n>tp1</span><span class=p>.</span><span class=n>y</span><span class=p>);</span>      
</span></span><span class=line><span class=cl>  <span class=n>v2f_t</span> <span class=n>vec2</span> <span class=o>=</span> <span class=n>v2f_set</span><span class=p>(</span><span class=n>pt</span><span class=p>.</span><span class=n>x</span> <span class=o>-</span> <span class=n>tp2</span><span class=p>.</span><span class=n>x</span><span class=p>,</span> <span class=n>pt</span><span class=p>.</span><span class=n>y</span> <span class=o>-</span> <span class=n>tp2</span><span class=p>.</span><span class=n>y</span><span class=p>);</span>      
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=n>v2f_t</span> <span class=n>n0</span> <span class=o>=</span> <span class=n>v2f_set</span><span class=p>(</span><span class=n>tp1</span><span class=p>.</span><span class=n>y</span> <span class=o>-</span> <span class=n>tp0</span><span class=p>.</span><span class=n>y</span><span class=p>,</span> <span class=o>-</span><span class=n>tp1</span><span class=p>.</span><span class=n>x</span> <span class=o>+</span> <span class=n>tp0</span><span class=p>.</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v2f_t</span> <span class=n>n1</span> <span class=o>=</span> <span class=n>v2f_set</span><span class=p>(</span><span class=n>tp2</span><span class=p>.</span><span class=n>y</span> <span class=o>-</span> <span class=n>tp1</span><span class=p>.</span><span class=n>y</span><span class=p>,</span> <span class=o>-</span><span class=n>tp2</span><span class=p>.</span><span class=n>x</span> <span class=o>+</span> <span class=n>tp1</span><span class=p>.</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v2f_t</span> <span class=n>n2</span> <span class=o>=</span> <span class=n>v2f_set</span><span class=p>(</span><span class=n>tp0</span><span class=p>.</span><span class=n>y</span> <span class=o>-</span> <span class=n>tp2</span><span class=p>.</span><span class=n>y</span><span class=p>,</span> <span class=o>-</span><span class=n>tp0</span><span class=p>.</span><span class=n>x</span> <span class=o>+</span> <span class=n>tp2</span><span class=p>.</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=n>b32_t</span> <span class=n>side0</span> <span class=o>=</span> <span class=n>v2f_dot</span><span class=p>(</span><span class=n>n0</span><span class=p>,</span><span class=n>vec0</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mf>0.f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>b32_t</span> <span class=n>side1</span> <span class=o>=</span> <span class=n>v2f_dot</span><span class=p>(</span><span class=n>n1</span><span class=p>,</span><span class=n>vec1</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mf>0.f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>b32_t</span> <span class=n>side2</span> <span class=o>=</span> <span class=n>v2f_dot</span><span class=p>(</span><span class=n>n2</span><span class=p>,</span><span class=n>vec2</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mf>0.f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>side0</span> <span class=o>==</span> <span class=n>side1</span> <span class=o>&amp;&amp;</span> <span class=n>side0</span> <span class=o>==</span> <span class=n>side2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Barycentric:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>b32_t</span> <span class=nf>barycentric</span><span class=p>(</span><span class=n>v2f_t</span> <span class=n>tp0</span><span class=p>,</span> <span class=n>v2f_t</span> <span class=n>tp1</span><span class=p>,</span> <span class=n>v2f_t</span> <span class=n>tp2</span><span class=p>,</span> <span class=n>v2f_t</span> <span class=n>pt</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=n>f32_t</span> <span class=n>denominator</span> <span class=o>=</span> <span class=p>((</span><span class=n>tp1</span><span class=p>.</span><span class=n>y</span> <span class=o>-</span> <span class=n>tp2</span><span class=p>.</span><span class=n>y</span><span class=p>)</span><span class=o>*</span>
</span></span><span class=line><span class=cl>                     <span class=p>(</span><span class=n>tp0</span><span class=p>.</span><span class=n>x</span> <span class=o>-</span> <span class=n>tp2</span><span class=p>.</span><span class=n>x</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=n>tp2</span><span class=p>.</span><span class=n>x</span> <span class=o>-</span> <span class=n>tp1</span><span class=p>.</span><span class=n>x</span><span class=p>)</span><span class=o>*</span>
</span></span><span class=line><span class=cl>                     <span class=p>(</span><span class=n>tp0</span><span class=p>.</span><span class=n>y</span> <span class=o>-</span> <span class=n>tp2</span><span class=p>.</span><span class=n>y</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=n>f32_t</span> <span class=n>a</span> <span class=o>=</span> <span class=p>((</span><span class=n>tp1</span><span class=p>.</span><span class=n>y</span> <span class=o>-</span> <span class=n>tp2</span><span class=p>.</span><span class=n>y</span><span class=p>)</span><span class=o>*</span>
</span></span><span class=line><span class=cl>           <span class=p>(</span><span class=n>pt</span><span class=p>.</span><span class=n>x</span> <span class=o>-</span> <span class=n>tp2</span><span class=p>.</span><span class=n>x</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=n>tp2</span><span class=p>.</span><span class=n>x</span> <span class=o>-</span> <span class=n>tp1</span><span class=p>.</span><span class=n>x</span><span class=p>)</span><span class=o>*</span>
</span></span><span class=line><span class=cl>           <span class=p>(</span><span class=n>pt</span><span class=p>.</span><span class=n>y</span> <span class=o>-</span> <span class=n>tp2</span><span class=p>.</span><span class=n>y</span><span class=p>))</span> <span class=o>/</span> <span class=n>denominator</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=n>f32_t</span> <span class=n>b</span> <span class=o>=</span> <span class=p>((</span><span class=n>tp2</span><span class=p>.</span><span class=n>y</span> <span class=o>-</span> <span class=n>tp0</span><span class=p>.</span><span class=n>y</span><span class=p>)</span><span class=o>*</span>
</span></span><span class=line><span class=cl>           <span class=p>(</span><span class=n>pt</span><span class=p>.</span><span class=n>x</span> <span class=o>-</span> <span class=n>tp2</span><span class=p>.</span><span class=n>x</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=n>tp0</span><span class=p>.</span><span class=n>x</span> <span class=o>-</span> <span class=n>tp2</span><span class=p>.</span><span class=n>x</span><span class=p>)</span><span class=o>*</span>
</span></span><span class=line><span class=cl>           <span class=p>(</span><span class=n>pt</span><span class=p>.</span><span class=n>y</span> <span class=o>-</span> <span class=n>tp2</span><span class=p>.</span><span class=n>y</span><span class=p>))</span> <span class=o>/</span> <span class=n>denominator</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=n>f32_t</span> <span class=n>c</span> <span class=o>=</span> <span class=mf>1.f</span> <span class=o>-</span> <span class=n>a</span> <span class=o>-</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mf>0.f</span> <span class=o>&lt;=</span> <span class=n>a</span> <span class=o>&amp;&amp;</span> <span class=n>a</span> <span class=o>&lt;=</span> <span class=mf>1.f</span> <span class=o>&amp;&amp;</span> <span class=mf>0.f</span> <span class=o>&lt;=</span> <span class=n>b</span> <span class=o>&amp;&amp;</span> <span class=n>b</span> <span class=o>&lt;=</span> <span class=mf>1.f</span> <span class=o>&amp;&amp;</span> <span class=mf>0.f</span> <span class=o>&lt;=</span> <span class=n>c</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>&lt;=</span> <span class=mf>1.f</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Of course, these could be written better but I&rsquo;m just writing it as the algorithm suggested without too much care.
I didn&rsquo;t care about which one was faster until one day I ran a scene with tons of triangles on my Surface Go, which I eventually experienced some slowdown.
That&rsquo;s when I decided to profile them.</p><p>These are the results on my Surface Book 2, with MSVC compiler:</p><table><thead><tr><th>Algorithm</th><th>Unoptimized</th><th>-O2</th></tr></thead><tbody><tr><td>Barycentric</td><td>~72 cycles</td><td>~27 cycles</td></tr><tr><td>Dot Product</td><td>~262 cycles</td><td>~27 cycles</td></tr><tr><td>Parametric</td><td>~100 cycles</td><td>~37 cycles</td></tr></tbody></table><p>It was interesting to see the results.
At first I was surprised to see the Dot Product version so slow because it was what others claimed to be fast, but thankfully after optimization, it ended up being (one of the) fastest.</p></div></div></div><footer>Powered By Hugo | v2.0 | © 2022 Gerald Wong</footer></body></html>